package main

import (
	"flag"
	"fmt"

	"github.com/pingcap/tidb"
	"github.com/pingcap/tidb/config"
	"github.com/pingcap/tidb/layer"
	"github.com/pingcap/tidb/terror"
)

func main() {
	configPath = flag.String("config", "", "config file path")
	cfg = config.GetGlobalConfig()
	if *configPath != "" {
		err := cfg.Load(*configPath)
		terror.MustNil(err)
	}
	fullPath := fmt.Sprintf("%s://%s", cfg.Store, cfg.Path)
	storage, err = tidb.NewStore(fullPath)
	server, err := layer.NewLayer(cfg, storage)
	if err != nil {
		terror.Log(err)
		return
	}
	server.Run()
}
